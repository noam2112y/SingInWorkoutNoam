<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:SignInWorkoutYavin.ViewModels"
             xmlns:models="clr-namespace:SignInWorkoutYavin.Models"
             x:DataType="viewmodels:UsersListPageViewModel"
             x:Class="SignInWorkoutYavin.Views.UsersListPage"
             Title="UsersListPage">

    <Grid RowDefinitions=".13*,.13*,.9*">

        <!-- Title + Add -->
        <Grid ColumnDefinitions="7*,3*">
            <Label HorizontalOptions="Center"
                   VerticalOptions="Center"
                   Margin="80,0,0,0"
                   TextColor="CadetBlue"
                   FontAttributes="Bold"
                   Text="Users List"
                   FontSize="30"/>

            <Button Grid.Column="1"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                    Background="Green"
                    TextColor="White"
                    Text="Add"
                    FontSize="20"/>
        </Grid>

        <!-- Find + Filter -->
        <Grid Grid.Row="1" ColumnDefinitions="7*,3*">
            <SearchBar Placeholder="find user"
                       Text="{Binding SearchText}" />

            <Button Grid.Column="1"
                    Margin="0,0,0,15"
                    Background="Transparent"
                    ImageSource="filteroff.png"/>
        </Grid>

        <!-- Refresh + Users Collection -->
        <RefreshView Grid.Row="2"
                     Command="{Binding GetAllUsersCommand}"
                     IsRefreshing="{Binding IsBusy}">

            <CollectionView x:Name="UsersCollection"
                            SelectionMode="None"
                            ItemsSource="{Binding AllUsers}">

                <!-- Header -->
                <CollectionView.Header>
                    <HorizontalStackLayout>
                        <Label HorizontalTextAlignment="Center"
                               TextColor="Gray"
                               Text="Pull down to refresh | "
                               FontSize="15"
                               Margin="20,0,0,0"/>

                        <Label HorizontalTextAlignment="Center"
                               TextColor="Gray"
                               Text="כותרת עליונה"
                               FontSize="15"
                               Margin="5,0,0,0"/>
                    </HorizontalStackLayout>
                </CollectionView.Header>

                <!-- Footer -->
                <CollectionView.Footer>
                    <HorizontalStackLayout>
                        <Label HorizontalTextAlignment="Center"
                               TextColor="Gray"
                               Text="To be continued... | "
                               FontSize="15"
                               Margin="20,0,0,0"/>

                        <Label HorizontalTextAlignment="Center"
                               TextColor="Gray"
                               Text="כותרת תחתונה"
                               FontSize="15"
                               Margin="5,0,0,0"/>
                    </HorizontalStackLayout>
                </CollectionView.Footer>

                <!-- Empty View -->
                <CollectionView.EmptyView>
                    <StackLayout Padding="20"
                                 HorizontalOptions="Center"
                                 VerticalOptions="Center">
                        <Label HorizontalTextAlignment="Center"
                               TextColor="Gray"
                               Text="Users not found!"
                               FontSize="24" />
                        <Label HorizontalTextAlignment="Center"
                               TextColor="Gray"
                               Text="Pull down to refresh"
                               FontSize="24"
                               Margin="0,0,0,100"/>
                    </StackLayout>
                </CollectionView.EmptyView>

                <!-- Item Template + Swipe -->
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:User">

                        <SwipeView>

                            <SwipeView.LeftItems>
                                <SwipeItems Mode="Execute">
                                    <SwipeItem Text="צפייה"
                                               IconImageSource="account.png"
                                               Command="{Binding BindingContext.ViewAccountPageCommand, Source={x:Reference UsersCollection}}"
                                               CommandParameter="{Binding .}" />
                                </SwipeItems>
                            </SwipeView.LeftItems>

                            <SwipeView.RightItems>
                                <SwipeItems Mode="Execute">
                                    <SwipeItem Text="מחיקה"
                                               BackgroundColor="Red"
                                               Command="{Binding BindingContext.DeleteUserCommand, Source={x:Reference UsersCollection}}"
                                               CommandParameter="{Binding .}">
                                        <SwipeItem.IconImageSource>
                                            <FontImageSource FontFamily="MaterialSymbols1"
                                                             Glyph="&#xe872;" />
                                        </SwipeItem.IconImageSource>
                                    </SwipeItem>
                                </SwipeItems>
                            </SwipeView.RightItems>

                            <!-- Card -->
                            <Border Margin="15,7"
                                    Padding="15"
                                    Background="White"
                                    Stroke="LightGray"
                                    StrokeShape="RoundRectangle 10">

                                <Grid ColumnDefinitions="*,Auto"
                                      RowDefinitions="Auto,Auto"
                                      RowSpacing="5">

                                    <HorizontalStackLayout>
                                        <Label FontAttributes="Bold"
                                               FontSize="16"
                                               Text="{Binding FirstName}"
                                               VerticalOptions="Center"/>

                                        <Label Margin="5,0,0,0"
                                               FontAttributes="Bold"
                                               FontSize="16"
                                               Text="{Binding LastName}"
                                               VerticalOptions="Center"/>
                                    </HorizontalStackLayout>

                                    <Label Grid.Row="1"
                                           FontSize="13"
                                           Text="{Binding UEmail}"
                                           TextColor="Gray"
                                           VerticalOptions="Center"/>

                                    <Border Grid.RowSpan="2"
                                            Grid.Column="1"
                                            Padding="10,5"
                                            BackgroundColor="{AppThemeBinding Light=LightGray, Dark=#333333}"
                                            StrokeShape="RoundRectangle 15"
                                            VerticalOptions="Center">

                                        <Label FontAttributes="Bold"
                                               FontSize="12"
                                               Text="{Binding RegDate, StringFormat='{0:dd/MM/yyyy}'}"
                                               VerticalOptions="Center"/>
                                    </Border>

                                </Grid>
                            </Border>

                        </SwipeView>

                    </DataTemplate>
                </CollectionView.ItemTemplate>

            </CollectionView>
        </RefreshView>

    </Grid>
</ContentPage>
